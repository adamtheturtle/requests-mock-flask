fail_fast: true

# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
default_install_hook_types: [pre-commit, pre-push, commit-msg]
repos:
- repo: meta
  hooks:
    - id: check-useless-excludes
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v5.0.0
  hooks:
  - id: check-added-large-files
  - id: check-case-conflict
  - id: check-executables-have-shebangs
  - id: check-merge-conflict
  - id: check-shebang-scripts-are-executable
  - id: check-symlinks
  - id: check-json
  - id: check-toml
  - id: check-vcs-permalinks
  - id: check-yaml
  - id: end-of-file-fixer
  - id: file-contents-sorter
    files: spelling_private_dict\.txt$
  - id: trailing-whitespace
- repo: local
  hooks:
  - id: actionlint
    name: actionlint
    entry: actionlint
    language: python
    pass_filenames: false
    types_or: [yaml]

  - id: shellcheck
    name: shellcheck
    entry: shellcheck --shell=bash --exclude=SC1017
    language: python
    types_or: [shell]

  - id: shellcheck-docs
    name: shellcheck-docs
    entry: doccmd --language=shell --language=console --command="shellcheck --shell=bash --exclude=SC1017"
    language: python
    types_or: [markdown, rst]

  - id: shfmt
    name: shfmt
    entry: shfmt --write --space-redirects --indent=4
    language: python
    types_or: [shell]

  - id: shfmt-docs
    name: shfmt-docs
    entry: doccmd --language=shell --language=console --skip-marker=shfmt --no-pad-file --command="shfmt --write --space-redirects --indent=4"
    language: python
    types_or: [markdown, rst]

  - id: mypy
    name: mypy
    stages: [pre-push]
    entry: python -m mypy .
    language: python
    types_or: [python, toml]
    pass_filenames: false

  - id: mypy-docs
    name: mypy-docs
    stages: [pre-push]
    entry: doccmd --language=python --command="mypy"
    language: python
    types_or: [markdown, rst, python, toml]

  - id: check-manifest
    name: check-manifest
    stages: [pre-push]
    entry: python -m check_manifest .
    language: python
    pass_filenames: false

  - id: pyright
    name: pyright
    stages: [pre-push]
    entry: python -m pyright .
    language: python
    types_or: [python, toml]
    pass_filenames: false

  - id: pyright-docs
    name: pyright-docs
    stages: [pre-push]
    entry: doccmd --language=python --command="pyright"
    language: python
    types_or: [markdown, rst, python, toml]

  - id: vulture
    name: vulture
    entry: python -m vulture .
    language: python
    types_or: [python]
    pass_filenames: false

  - id: vulture-docs
    name: vulture docs
    entry: doccmd --language=python --command="vulture"
    language: python
    types_or: [python]
    pass_filenames: false

  - id: pyroma
    name: pyroma
    entry: python -m pyroma --min 10 .
    language: python
    pass_filenames: false
    types_or: [toml]

  - id: deptry
    name: deptry
    entry: python -m deptry src/
    language: python
    pass_filenames: false

  - id: pylint
    name: pylint
    entry: python -m pylint *.py src/ tests/ docs/
    language: python
    stages: [manual]
    pass_filenames: false

  - id: pylint-docs
    name: pylint-docs
    entry: doccmd --language=python --command="pylint"
    language: python
    stages: [manual]
    types_or: [markdown, rst, python, toml]

  - id: ruff-check-fix
    name: Ruff check fix
    entry: python -m ruff check --fix
    language: python
    types_or: [python]

  - id: ruff-check-fix-docs
    name: Ruff check fix docs
    entry: doccmd --language=python --command="ruff check --fix"
    language: python
    types_or: [markdown, rst]

  - id: ruff-format-fix
    name: Ruff format
    entry: python -m ruff format
    language: python
    types_or: [python]

  - id: ruff-format-fix-docs
    name: Ruff format docs
    entry: doccmd --language=python --no-pad-file --command="ruff format"
    language: python
    types_or: [markdown, rst]

  - id: doc8
    name: doc8
    entry: python -m doc8
    language: python
    types_or: [rst]

  - id: interrogate
    name: interrogate
    entry: python -m interrogate
    language: python
    types_or: [python]

  - id: interrogate-docs
    name: interrogate docs
    entry: doccmd --language=python --command="interrogate"
    language: python
    types_or: [markdown, rst]

  - id: pyproject-fmt-fix
    name: pyproject-fmt
    entry: pyproject-fmt
    language: python
    types_or: [toml]
    files: pyproject.toml

  - id: linkcheck
    name: linkcheck
    entry: make -C docs/ linkcheck SPHINXOPTS=-W
    language: python
    types_or: [rst]
    stages: [manual]
    pass_filenames: false

  - id: spelling
    name: spelling
    entry: make -C docs/ spelling SPHINXOPTS=-W
    language: python
    types_or: [rst]
    stages: [manual]
    pass_filenames: false

  - id: docs
    name: Build Documentation
    entry: make docs
    language: python
    stages: [manual]
    pass_filenames: false
# We use system Python, with required dependencies specified in pyproject.toml.
# We therefore cannot use those dependencies in pre-commit CI.
ci:
  skip:
  - actionlint
  - check-manifest
  - deptry
  - doc8
  - docs
  - interrogate
  - interrogate-docs
  - linkcheck
  - mypy
  - mypy-docs
  - pylint
  - pyproject-fmt-fix
  - pyright
  - pyright-docs
  - pyroma
  - ruff-check-fix
  - ruff-check-fix-docs
  - ruff-format-fix
  - ruff-format-fix-docs
  - shellcheck
  - shellcheck-docs
  - shfmt
  - shfmt-docs
  - spelling
  - vulture
  - vulture-docs
